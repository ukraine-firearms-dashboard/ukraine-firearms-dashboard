name: update_dashboard_text

on:
   workflow_dispatch:

jobs:
  update_dashboard_text:
    runs-on: windows-2022
    steps:
      - uses: actions/checkout@v3

      # - uses: r-lib/actions/setup-r@v2
      #   with:
      #     use-public-rspm: true
      
      # - name: Load packages
      #   run: |
      #     install.packages(c("data.table", "dplyr", "stringr","googledrive"))
        
      #   shell: Rscript {0}

      # - name: Update data
      #   env: 
      #     GOOGLE_TOKEN: ${{ secrets.GOOGLE_TOKEN}}
      #   run: |
      #      source("R/01_data_preparation/02_update_text.R")
      #   shell: Rscript {0}
        
      - name: Set up Git config
        run: |
          git config --local user.name "ukraine-firearms-dashboard"
          git config --local user.email "ukraine.firearms.dashboard@gmail.com"

      - name: Check for changes and commit
        run: |
           Write-Host "Current Git status:"
           git status
           # Set the error action preference to continue (don't stop on error)
           $ErrorActionPreference = "Continue"
            
           # Get the result of the git diff --exit-code command
            $diffResult = git diff --exit-code
            
           # Check if there are no changes (diffResult will be 0)
           if ($diffResult -eq 0) {
                Write-Host "No changes detected, skipping commit."
           } else {
               Write-Host "Changes detected, proceeding with commit."
               git add data\text\about.csv
               git add data\text\popup_start.csv
               git add data\text\resource_list.csv
               git commit -am "GH Action text file added $(Get-Date)"
           }
            
           # Reset the error action preference to default behavior
           $ErrorActionPreference = "Stop"
